<!DOCTYPE html><html lang="cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0"><meta name="description" content="cpu性能分析 [ 聪少 ] "><meta name="theme-color" content="#ebc65a"><title>cpu性能分析 [ 聪少 ] </title><style>@font-face {
  font-family: 'Abril Fatface';
  font-style: normal;
  font-weight: 400;
  src: local('Abril Fatface'), local('AbrilFatface-Regular'), url(data:font/woff2;base64,d09GMgABAAAAAB6MAA4AAAAAWmgAAB43AAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGi4bl2wcfgZgAHwRCAr+OON7C4JaAAE2AiQDhTAEIAWEWgeLXRvXShVsnMqGjcMAxL/ZoigfnMnF/5+TGzIE+xGnVSsoEkTprOLCatNCL3NWSrwGiVOeC1Ma4cRt9lKgeMLz6SDPn09f5BtlurhiH5hIRzKSsRXMg/2K5qMneJOanClsEllsWP7NwOgqOFj6FH46vhRKUfOL5PSG6O7ZpIb/7ghNTtFKFL8f6Oz9HyB2gEJFGABURA7JRcURynBBVVVVEfjaVjZveNrmvyMVlLgDjAIbq0BRoixmAoc9xagA10Z/t/6hiw51a9Sf5Tr9f+7nX9R9G6UXWCTYMCLEPk9sZ7QJDSSDqqja7xmbofKolVLIeIlEfCKG+J+43uQWboIdYg0osAFwdFtjr5hfMLliVkqHntfzZUk/yOLTCchsysWeVcP5D/2eUnVVDAqlatMITV/otwweT6qRETrBhufZe/w9A0KwLhbLhqekMPw/qOf776uRyqkxyGJz6D2a+mJFZw6JbSj+RXvpp4AlwaA2M4Pyk5OLXTPPnBc+LoXWqgUpPkHy2Uo2sV3v1vv2IDOPXThRzoyIaxUsYlKl49qjjaog0/8yPr1qrfWzbPZC8iVCyr2WaMjLNRWUVF59Wf++grX5gndvjZfkM8m+6LsDLPlb69UlrcgmptDFWDK0IcWKXDEUTU9N2VOim4hET3fOx9aKBJfKXmXqsOuRk57yyGuqMIgiisiWHucv13Ec8//t/Ytzh5bQpP7kAhhufJwLHgQLgpCDKChgKK0HmbATBAIM5SoIZvZ9FyiH99ZXAgocwE+TWQ4drK0EZgB2P+BgAB0L6TUE4sy5/eHKI001IWEpCcknkL/8EAvOEiWpVa9Bo6XWmrDZVhAhKgxhq6tpKyAwHKDn6CXnvAXBSRQ2CMVocSzAGrawhyPYcIYr3OEJL/jADwEIQgjCEActdEA5cOEjRIwUEAUqNOgwYFr6wpGF2tCBLhixpHCZUCsM1vNHHwYwgjGMYw2bFNkWwza2o5FLbvbRaeBs5qrfrid2E7jPHlP2FHjOXkIKAgAAAAAAAAAAAAAAAAAAAAAAAEASSSSRRBJJ9GEWAAAAAAD0oQ99hbNRu9RbGFbYANgvfaSdobjhjife8Ynv8Z7pzs6tzE//CmwAx3qR6+JDdIx70gF2Wx0w9aERucpEqSHczG3IYNUYUXV3gqXVnpWl1FukCSlYkSQO1ateJXEiq2WNaWyW8TSOBdxzOqygMQnapuIQicSQyAQIkyrx+JN5fKRs1qbjA0jTqNheYQ0s2j9VJf6zKo8baai3PDlPejAKERVuDwuDBMTBHF0MxQIq06VOEqWxoo54q97O2ndFO6abDMiN2As0/CytLuRihyqSNGLSxvvolu27IZa08Y5qm6hsSOvQjyXdPdfSUrZaZPKC/pWotKq9fNXnHik3bTaRZr2yybCVHBSuBFhkJfgQs3HqEWGFl7uCDOkTWTZlZviMNdg49F5HsjtyAOmiSdKWyOWRv1KzJAxjMxflsmOwxEJ5fHwlhXL+6XfY3HHmVQFHRlmB6hypqpyXZuNJ0McToMTKzZSEpfQ6ZU07zorLXi034lrEzzLq1oy6f72YcG5+o29Zq5Bk78GvLaFKqWZdtuysCCS6Ldc97Sf5Ka7npEoXmibZXtxbBeegNE9/+knYSn52a5cqiSvuK8LsFHMIDmAeF1Ru9GgKFEhUpEiSEgOSDRvV5CvrtZqwgxGEYTU6MKkLgYdhgO3u2NTFQUbgWW8QYxgRc8cTsLCYsVrQnLW87ySxgQWBqXXJ7Ba0YD9qSw4rp2CjclyQxkkes2NgAS1F0oepSBLSRJHKQBBrsskodSHmI4CRGzykLoRWNLpMBlIjBFbJiZjvS5SaCQQsVqyUwxLR64IY5FFjWawcxxIeaUEzcBLg3EDcK5I+VkZJQpooUvJf/HUjaWXRO6NWrlax0datXsRm/R+AATUzA3X4mL4cUIZ2BkCQh10QEDCYPXUUOKutsdY6EJxKVWrVwWQ6Hnigvq4i4G4zSf4Q5P0/LFonuTT2AdDTcboNG9iziQPiSnrnLz/wQOIyG7gHkN9rETCbgAYaNt40CCI4xY/PRDRYhAQkOV0Zyf968WZem3mGsLUT0PKoy8irrIdenHnap5uR4dwfgY7z+eXPyezD3wQZ1xFQ0yjqm/IFyxYgwwEY9x0w+R2Q20COMzXMBBgTGmQki4VtCiH1akB6Zz+bCOqBBYVM1WwwdxwuxmwIRK0ZfaN2SlYrJlSoVBGJilhm3Tut4Th4atM2pp4Y2WD9A9n0DO5D/eATknLhUQsNzkU+UHJ8iPGh1McYaq5RU40ooZxMsoXUZm3VNPTmNTRwQrSlSeuExEqUac12EjvKooiyomD55DKXi8KsimQpt9jiJqEUL8biQTku5OqRlspKt9w0Zcptv7NczErJSpI0JI1YoRo42INZsHAwDn3SmE3pUhOqqC7VXLXU/1XADBnxpJM6BEiVPqrwINUHiV/TTSktWUqZ7HNwRzTdrKdAhXsmIV4wnmzxjEf8PGmrimdtm6ATiF528nTE+S4KIPpmX6Kd8Uyi1vFP3evw7+HeA4tdZoX+mn19hiW9p3oSCOo3r3f7vPsSUKRjAB9vNOSnQxzte2aSIUHnbvc225VjqIxl3+Cl/FGPHXIuO58IsOceVk6H+Cqy6X+1Oc5SY8ceBXL9fOE87z41mBvuLVhOX2v8vqnHmX1PZI4Qq8e8F0L6Bq7yiWkYk4YEBGLlkH+2r/Vtie6NBPL7jgDt6azA1viYmnuBh+yaGH6EPmc8cuDCnJjxp8r1tU0+76DogBhugyS4R8S54b5rC2gjKAxbl5IMwxZcsmiIH9q2ls7n7/B6GuCV15SKh4+kfYS9YFzy38kXZgSFrexdtlhv9KUnTh8j1RNprT5T30XarpY3b/Q2d9K/4j4r3rV6dJ1pFw1iCK2k5VGc7yWLaAUoh0icLnfiC7/llN725gy7eR/wA+OIOzhz+PJn/Yl3PQHCxqxuucQcO9fx4fcozDkLam/Uk5tcMvDgwa53De4/njyUIxODQRcdeeEK4xiD/cK75DjQVFjbK+n1g3/8sf29u+c99XnRQZba9O112h4iQL0QFNefiZcQWtuxnopsRofb7F2S+rY5qABRqgR1qHvcL5EYdmdfASb1v+beYFwKJJAZhtojLMadJkIMIywSgPS2FCPoK+eymsJ4RiWx3d2wRBES6qR7ZCOa3SNpg8JpqfWyIEZYerzc9rZCKs62DXBR20RnTXC/SygrI+baSlfX+j/xs+MpvIom1MTE5tQ2zJXf82ltuxNVMOYBy0aPeUk7ADT+y9sBkf8MA9YvCFqfrxBeuW+MrUUsnNnvQLv/F5Cefmuxck2ct4Ohb1HVyJfkSkVlnaLIqZAobW6ycxK7X5m5ZpCEOQwlwACIfsVCBHCxttL55xCyCqwkW/KfD6qnpoHogGx48JLrO1YzW3vY9593rasIjworDYYJ3nh4rE3F8svVELL3gyCqS5lLMpiCb1mUlkxR19aC7nQOd/WOLxwV9ztXiPfAi1ZTpJO+k78Zvzb7O3zDDa0fAZ0T0WwaavZLkXo2DDmkcv8ANW9YfGhbkjaOyz7LnEaxZLWY4WLbNd85S/NDEDNSJpYWTBkc2mJUUSYfjyjBKmCfKSpmm2wrbOZ23fRmTStxS/xT0VSkxz9Vvxtqo8YsZ8KqbFEsKYecJhdcVf+dbsKRSi1K7nW0gvJIrBzGnMcrpKuBhg0laVxOjvnJXEoESqKavT3mp5sHRcy6Wm7wSPB0k8HkosY9G6y/uEPZUHB7sld1Y49qq0sMt+p3IGxLz6Fdu+y/AThrs5/3bfP73JL5/tluUytkCfgsnl8GoCsb5W2tLV37mfZUF5HuygjiPnFPG0xqMNsHDDf27nVxM93umWt3W9IxI4G2u6Sgx1G4rUNzBr4uxeyOKqu0e+KZ541zc3Ned6FO76TZbW64x2SYnT08dfy0zW5wsRVOWZO05CKRXTxHhWnbU/65EQNAhOZ+3zTuJPc6eBrW9u41sjaRehgs2ZG5njEGtZPh/5yzlmrE5MDJ3Jltlak3BT6SnfOq0tAmkNdjUpNQ9DgOQgGMxCGqSyRwYNEnm565OVlmI6MhVWna2FWZ0d3FSSoxvbb0RshYOgElIesiojQEf816ZjMJUjDe1Df3Byxdf+uzudilmIWPw9JAuVg/ejkGcu9Z45meU7N3jfd67xhus9t7sc3ZT2UayDsvkboY7tRhnidePKY+Q0s6BjOF7KJwSi+6GrqlHFHOhZbJbT6WnNAEivsco8x+aBvTAnQMIyygDGUAsYcqwYP9iaZblrbuVeJqFnGcoqxnH+gDPzp3UL8ZPe8znWOrydYknamVD10sMGwm9150ySCxEYhwLr3euKXNvF2AjclCpdPX3aY1OnLnk1Bbg8PzHK7DjYqi0zmHIpcklqTLzhrKyDoyFlUzcpwNRd3Us6OtR6BUu6NzesgYlLm/d15r4OTsIfX47GKbQAhWg+4JWIuesE3aUTdLXjbbZAx6RtCQDrZHtnGE4zMjdkglOxy7Xoqj3bEj4xiL1uSYZe5kDc2VcbG999tPCZSZFlX7FfiWs3lekXoNQ3sCMu70YKR1zLl0+6uZlvbmBCrxKSgC1mvGdq3ZwNgANpC0xu/W7Rnfw4LmnSZNPXuMe3tn3daR5Znst873Hkf/t9N946u7wjNbllVOBVr8C557h0U5DLEjfIGTZFMvsHXXprbdaUpPKp8JcXDGF/6OtcMl0mZ67OXgoLGW6OoQ1Z7dTt/5ZhGFGTTAuefjllMVovfWNCoSR+iwxi0so76t/VmfsTMtS158K/EdF5Zw9LQAMGhuWPpoqKP6L7MeW4+8QL2w3qUNhqPzEvUip6LAZK/wPYvAOuq+bEdvqW1ufNDXFWi2x+qT9uLCvyZ0KwuH35RFqJgn2m21hoTUcK2PKjdZEZrIeF3HboovyyiXfJ/O4u+PuyIPCCaZvg2TVfknxAYmBPjXAtUlTS5D587altmXmVAxU7GV7XFq8ER2V9eTlYa3LY2tX47eWTdejtQiGubDvGM8+NniC7Fh2ZO5BzN2vnTtBkMOWthoUYW0UGLfXzAjo/+i35CTmRQY5sH4ZYS81iLIWOZ/24Z6u8n60IokGe3YtwXb9VpUuOEokSUHqX+T5ry5L1y/1ZcPP0cj8cEdvCA/+P9pHsiZgjEwNy1Jl6SAV8BeTVOrtEFZQctHp3xhfzgyIzV6wboE4KZgZzisPL4uXgb3w0EnbNlZyXGNslD1SddUBVXt0niayRUl2adk6XZMAU2csESxVFkc97f35xcT1Hjk0HLAd4jwzMK/FkOnllUC1v36vuxRRVFoxZ7HJXPGye+NSuQktqyt946GOS9DXc9nM3+38v4XGBVkBT+1e+GY+Suq+XhkLeL/eU/Khz1+SDSy+EUW/vAqsJeWy/VhDo49n++tKzn+J31ne/ydU/wPpOruYrcffKavzrVbqVpST0o81p4gOCb42qzaKeemwYpPY8sTpX8xneemxpL/Khs8sN47cSD5m6TKjFmY8Ct5yRqkw1EycWBv7omzm6LqHRlr0snE72Gf/OzSHcG1374wltA9928SC3+S3Q8uGT1r518U27aqXzYsO17VVkVdTsLmC1Hk5hPzg9KfganCzbqk0riTdoh0XIqEnju7YS/ZvUA7sC3iD43vsnjrG38JvVSmDFMumAj+0dtOaoVWhnSs5CQWa7Pb2t5d0e3ziILf/xwI//oT8flGvvMVzXX+W4dkABfaqjwlmIcVHkZ9IVXVJXoabY1gF0mB+YGMTTInO6Pg90N8Jp8XCBcqf1wB46SZ+WWYm58Rl+YS6uwvUs5Q+9DpcbdCrSXumYYKKw2D+IMbSzAkWJXhcg6BfFY8sUFn4K2/xdVJ+UBfxZ92rJ7H4mgRz4mli+HGetfCpkk+8YOHO6eNdEhXn93/1ulDWWYeOOF9QcxiszxsqdYcSo9LoOss0PrGBCzOq4xa6504Hrcm82eUT+dKJOPIWXuur1v2llxBe5OA2VJvy+ze03mq0rMKPrjPiE6StGL/NaWj8P+jHL33PHGxsXoMDeXoFdVeGnCEXSF+8Qck3Q7jJB+JCLsaJkDCEcH4e57yqjIC4f/lcy3KYDOZP3pW+UnCk/U7Xwg7mKuIfM5kB6RGMrxhe5g3zasCEQXDRq+OnnpUYatYUMIW/o4JEz+FXl11lf4MDu1k7pxScXs8IVPYyQPWJwMR3jgPeX9YAd0z0hIPxN3sICv6/Jeg4kH3+eEicBxxG1E4p2bjApU+dts3gvvrq2k+zIV5xwRUTVSdj18gnjm0HPN4Rh/zh27R5vvz/BxsV13aiB8Tdi8aYtRdqeMB/icBdz2Puo2iTae1IKsWB7w4OvHhP4EVCG/fipbW1uTsKL7309RVgt0eA3bfsTwrS97GgyK26JgZuZaPKJC+fLJ6pyFVJdEJE0pDUPf3BVFMeTlGAhfKFR3ozSfRXSpq+kC9n+LegZXu9G8Ovv6Rm7a0F7UXZ/9BRtbYhCcie5HInWefzIYhEsR/UmiMylU12GXGRn96k2G/6v9c//KDnWDetAB+9c+r309kw5dhZWP+rhRXOJUjhGMbcO+2AeNkMat0yFWTXxRcxoQX4C7NqxQPvF34R69+rq5DTQtuJZYWrkJ9cS0LFowqxCVfWEojeUeu9XQWFK/T3eTSCK2G0jqzgNsiNiYR4LlR12svb8vWw/NJd47EepQIrpNyJZyUaLcN1/uTLGWnxrjkCcCibdv7tMvrecgqV0sz8K/++sPbElUmJ9D8p2eZ3rrbMd4rXVDIRerHeFHf5WH7WD44c9G7DIcb5V0+PkcQzem9doEi0aYtHSVtpSBS6Laizfc84dhYXb8V6CiNyuFm5otuWJHTejAtiu8FJa7jDzos5PFExUGqOg2LM6QueM6iKXJx2mVzeP8P04mhKBtU+DiCl4a4o05hqujIvUfJ0Wk1Ma1w4ezvkkS/pe5rJw+h+y7JJ0/otpyGL1p0Yk5ADo24fNOdHRx/7AL/LS97gu6+dGAFg+PWlz5OjD945NAWhsul5fkgOjc0UYIoEMm4BPHrLrdNeb0jNUZDwCaRRLFoaMiEq3gpRFKXTMpVpbH8ixnKEHZ4mCLRIVEaEetY3YXmC+5ZFH/U5UP849Zd6t22W9zfgZwUpAqtSAlf4yV3WrhXkdbZVRla62g/QSZM0fy1xcVtMn5OUlCDU3y+e97kXmn58u7K8BEHM8oNivSI7q1dafT9qVq6mfKQrfhJy2fE8pzUoiSNKxEq/ZYGNSHOh0cpr90wsY4udpQXnpEX6qwZp6ukdsNk9vDJ4n2S+luGNKuXRrvdWyFVLLHd249s20nz94j3UtliscWIhrntdWF/yd3FO5maEUuxIp9rQMzfg+qAgAfzjMd993bD3cn+3pEzeogoj05SEzdQ9aMEH6eVFK+U3qOC3OfC7WzOiUDaqbagkt+nhohi4ix/yHZITM7E3xX8jJ/C58jkje9PPd7N7N6C/AuIDoGRzcLcSbSg+JIEGUF4p9srWqxG6voP8BABIjF90I63+IFNrj5dEz+jD/1caMUP+ToQVMbGuPCF/FhrpBPRKvKcUQXsQBhoHZet6DlpAorPx3EbRmWXoC4Sc1dZ+y1DrA5ciUHbHDXNwPwsbZ1KcRKcCUfCEMHY903fFyDXEOnRA2mjF40X0Q8H/BEFouwOrm+lr7afX0C7TJOOL4qPQp7vEPzti/1pYppEGcHun1nyH81363eS5THgnL6y1qEEJr8Aaa8RblrGovBmmPLzWq/u5tH9OIUfHrVU56C2eRTq9Unq0xPkggSJY5mlxdkVyh6dG7X1TEjwwX0zvwoyeS8uw02Bm9RHCw3fzzv/hXuzqLQVLoN5xyLgCNxQxZhREyvV/aRaHoy6IzKw7rCz2RmHrQOcgZAAq1UD6+vilALNq6TUkB/c77G/hlleZ9KNCE6E9WD/Nw276wajltC5ijxnL8Wyt5PzTBXRM0qv4f1EHfViFv5wbGe1thHy3bXbZkD9rR47vbd32njpps0s4aR9e/N0qlSfyFoR7y/q7nlRPLIO8R8YcTobcUVQF/T+eT1T9u67tFnws61ylY38nIyya8vp7aIs+0Wr7ONPymb+jttufpNzacxv6efvvnp7w2mXVLjkWApRUaMqI5qO8qBteaeRjfs+q6i1eMLtwhcMLbaLRW2jR/1lgxqlvDGcLA3wtErpLgvG1fq+ZnvZZOZhLO2rm7t4H9hnYO+2mVWfAStC7pa7Cu3grxDuq8/KtBNv/FQFNCB7n+U3Ld6lbAo6AXxL9zD/A8W2c97B5iNuI0pOVNwJHvKaeDtvwoec/3nei7ajq6EVe1sTfqv9tmWTeL8nvcQoVHlhxFf20jegvE3jbP+89j9TDL2aducRDAY+NvWIX4sH7r4tdiH0YweuMwhDUKCthtIQ/tXgWV5x+D7HSDQsPyYkVKShDxfzgykiTEBZyFAWoLkDPDAQAIhURJBAiHKnBcMSLFgMar+0FIhRoIsVVcx+SRHMovSpX0GCeRSsxep3ZQIpyj21FBPIlQ4Lxk+gKX8DwcLz+kEUvMQSP/2uBpZ5RBD21k+kdYpOcKEGz0foLivkY+As4B6a7hkWobquCD2+uDmjzEHp/MuvXgao1G8Qay5DAK8HgBslg0LrF9S2cz9fJk4kBxgo0oxwq3HNRO4wlUCYwg8Cj7hfofAlHrSlIqPS1UP3RIwy1Zi0VhJQ++sheJeyxIxDxITbcbEbQtVn5D75J17WzzhNs6mO4fmQDdzilVrT4fGwKTKP2bG+K8GtPUMEusX1J0yb7DG5K5DfSsIgIY37Sk5ZAdhWSWa5PWyMCyKP7CEIENKDs6t596jI/wAZ+z/A9+fcabhdzi+/9NbeGTAYBuAZ4Koto88ofVq4Csi46BvXPG9ZCXgL5F8rSo+Rv1ALB6hF+rLLCZwnSDmAU1lwnRSxGDB5KS+gtnCi4wNGHUF4oUSTPIArygWZF5i1Rs58gFQMktWYBsqC5D1ck1yw8keYVdwKAfINwEbPJlHtvxkIhKEgIafLZlNVpPADWoKapX6lgXIyOS01ZiJr2CgcziVE2iq1qVm9GAmS61sdQd74h7jh2pfx11EDt4ekTnAXLFC5C510J9cY2hsO3QMPKrNzjpSu7g1ClyV3SQZM2aH5AvKSaypdiNbWTN1O9+aAkAbiqNMZ1WDc2E7hNUvbaJygHCP4CmmJAgO0sTWURXiCsrt/FJEGDuYqY8KKBwMBBiuEBfXmAKQHAFkeYhvc8hiUOC6PlRKfShyR4RHuXJ7AM2seL4qQnCNTpVqLWiWKFKvH5kmPiy1IgMDJfOAIOaLWsnQBtSoUsOJTq+VoTYcOP/XEar7q9zP70atSgSuYbFIyP44txbW6gTXGmfOxKVWptJJJkKuiQl3WmUSeUVZOGLuuUil/IAIsd7DCAT0vgahnijQop3NW65BFHJxCbux9ZURsmlYkWafEE2PzpJ8AAhW1GzbAl/Qjt161CP4zWUfPjdGl69Xxk2R+lH6q1CriL5GSCgaAlhBkTLy5haR/I8jIKcWIk0JDSyddpgE/6vdNuBAWwh2qUmvyf36AVqdPIzEYMZnpDCaLzeHy+II88hSKxBIpCMGITK5QqtSavLQ6vcGIYjhBUiazxZp5Fm52h9Pl9kCgMDgCiUJjsDg8gUgiU6ip55NlVjQ6wGCyZNXmcHl8gVAklkhloFyhDFRqjTZfOF3G9QajyWyx2uwOZ269efDoyZ2XXO4enl7ePr7+DfK8CkYtFDcdQPZn89+MeBdT1O/2hwKrXHp77FFrKs8O2ONTJN9h5fxSeaCCZrpLAz/Swlp2VM9in13SR8TnDcMQIUCPI5argbFmfDUhGIMsq8Ejr6fWJi5EVE3RFqiHdBk/JS68nhYTlbmK3tOjynVmMP95qw3VvpUYP+EqxOjVBoaZUHWJgllFdXtWSVT3Cpy1ns0pcutC8ddOKFXAb7+ur6E96hV4stFWEn+IF9pcxZfzU+3aAlEk1NcSa/UhUejH+367ZaNYnv6amiTeUcLQStIWhIeQJAypKF2/+DrS8+9b+r84YC1QjYTmWmqtOaQKcws0rrB4vbaZomVftL3zwCbetAtNX0Jfw1D1yzO4hkBoC4PwFgLC1qTBzV416W3aOwJ3tbZWApe7sX3HiM3KAxHboqsFjk/h7nHO13DNXdW3JDX+dYgh+cJmfKKdkKXpH5+Te+m3pXdChEGOvZYmXkh0HZy9deKn7PtuJeuwC8ynEtPecOx0c73CcWprlrk9zYQ2e3xsgX1x7ao=) format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Abril Fatface';
  font-style: normal;
  font-weight: 400;
  src: local('Abril Fatface'), local('AbrilFatface-Regular'), url(data:font/woff2;base64,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BL3+M1K+NfPvjlJEHZTOrkYvtdprqx0Hka+W/IhsQoUJE0jsPVOhV2itgp3Wame8dsB73DeCOfp+FMSxp2At3aozP1zVQ/tmEpXdveum7kat3CaLXRcmTZHmOveMiqxSteCZOrGKmscOa9WycTUXtRFabrtts1Nb3e5qHtqWPMWtuEkMSdydcarhKoTcVXtBgujKwULbPFJvqywIzBjboUacECG6ajlIews5dBUMkJ/LYHa12gpRLEsBDAAA6raxOaTnbx4GG5J6hdn4twxT1DRvEQZvD6banOa3BbstVh48efHmw5cffwECBQkWIvK/LTbhIkSKEi1GrDjxEiRKkixFqjTpMmTKki1Hrjz5ChQqUqxEqTLlKlSqUq2e+hpoqJHGmmiqmeZhWGKoYfaZ7qXhxhtjnlWWxsBotw0xxWdfjDPDSEfc98l8q33z1XeLrXPKCeu10NJErZzR2kmnXXDWOee90sYVF12yQVsfTXLdVde088Y7o3TQXkedddLFQnb/qVGrq24cuuvhtZ5666WPfvraaZEB+htokLfe2+1GBDbalARuuueWzbbYboejttrmmBHW2O+AvUmRDMb6EEUsHHQoDskRjxRIiVRILev2qn1oaGpomZOB2z/jmn/eUk6tvaZda/5znbhPCguQ7wsEvd1strBI3OYR8ye01+ZO0jbH36oqKm37w90hl2v/wO5o3vIjtpoZx20H) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
</style><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><script src="https://cdn.bootcss.com/highlight.js/9.6.0/highlight.min.js" defer></script><script src="/js/paper.js" defer></script><script src="https://www.googletagmanager.com/gtag/js?id=xx-xxxxxxx-xx" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'xx-xxxxxxx-xx');</script><link rel="stylesheet" href="/css/tocbot.css"><script src="/js/tocbot.js" defer></script><script>window.addEventListener('DOMContentLoaded', () => {
  tocbot.init({
    // Where to render the table of contents.
    tocSelector: '.toc__content',
    // Where to grab the headings to build the table of contents.
    contentSelector: '.article__content',
    // Which headings to grab inside of the contentSelector element.
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    // For headings inside relative or absolute positioned containers within content.
    hasInnerContainers: true,
    orderedList: false,
    collapseDepth: 2,
  });
})</script><link rel="preload" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/github.min.css"><link rel="preload" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface&amp;display=swap"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="mask-border"></div><div class="head"><div class="head__inner"><h1><a href="/">聪少</a></h1><p></p></div></div><div class="paper-container"><div class="main"><div class="location-bar"><div class="line-1"><div class="horizontal-line" style="height: 3px"></div></div><div class="line-2"><div class="horizontal-line" style="height: 1px"></div></div><p class="text">cpu性能分析</p><div class="switch-button"><input class="container_toggle" type="checkbox" id="switch" name="mode"><label for="switch">Toggle</label></div><div class="line-3"><div class="horizontal-line" style="height: 1px"></div></div></div><div class="main__2-col"><article class="post-view__article"><div class="article__infomation"><div class="posts-item"><h2 class="posts-item__title"><a href="">cpu性能分析</a></h2><span class="post__date">2020-12-08</span><a href="/tags/linux/"><span class="post__tags">#linux</span></a></div></div><div class="article__content"><ul>
<li>面对问题束手无策</li>
<li>面对“系统”、“底层”发怵</li>
<li>遇到根源复杂的性能问题既不懂怎么去分析，也不能抽丝剥茧的找到瓶颈</li>
<li>随遇而安，认为遇到问题上网查就行了。有可能解决问题，但是懒得研究为何有效<span id="more"></span>
<h1 id="性能和性能分析"><a href="#性能和性能分析" class="headerlink" title="性能和性能分析"></a>性能和性能分析</h1>关于性能，我们首先想到的就是<code>高并发</code>、<code>响应快</code>。这两个词对应着性能优化的两个核心指标“吞吐”和“延时”。而这两个指标是<br>从<code>应用负载</code>的角度来考察性能。我们知道，随着应用负载的增加，系统资源的使用也会升高，甚至达到极限。而<code>性能的本质</code>就<br>是系统资源达到瓶颈，无法支撑更多的请求。</li>
</ul>
<p><code>性能分析</code>就是为了找出<code>应用或者系统的瓶颈，并设法去避免或者缓解它们</code><br>，从高更高效的利用系统资源处理更多的请求。这通常包含了以下几个步骤：</p>
<ul>
<li>选择指标评估应用程序和系统的性能</li>
<li>为应用程序和系统设置性能目标</li>
<li>进行性能基准测试</li>
<li>性能分析定位瓶颈</li>
<li>优化系统和应用程序</li>
<li>性能监控和告警</li>
</ul>
<h1 id="理解平均负载"><a href="#理解平均负载" class="headerlink" title="理解平均负载"></a>理解平均负载</h1><p>当发现系统变慢的时候，我们通常做的第一件事就是执行<code>top</code>或者<code>uptime</code>来观察系统负载情况。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[root@test-monitor-alert-1 ~]# uptime<br> 10:26:33 up 26 days, 17:10,  2 users,  load average: 0.02, 0.04, 0.05<br></code></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs conf">10:26:33                           // 当前时间<br>up 26 days                         // 系统运行时间<br>2 users                            // 正在登陆用户<br>load average: 0.02, 0.04, 0.05     // 依次则是过去 1 分钟、5 分钟、15 分钟的平均负载<br></code></pre></td></tr></table></figure>

<p>理解平均负载之前我们先了解以下两种状态</p>
<ul>
<li>可运行状态: 所谓可运行状态的进程，是指正在使用CPU或者正在等待CPU的进程，也就是我们常用ps命令看到的，处于R状态（Running 或 Runnable）的进程。</li>
<li>不可中断状态: 不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的I/O响应，也就是我们在ps命令中看到的D状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程。</li>
</ul>
<p>平均负载实际上就是平均活跃进程数，直观上的理解就是单位时间内的活跃进程数，但它实际上是活跃进程数的指数衰减平均值。这个“指数衰减平均”的详细含义不用计较，这只是系统的一种更快速的计算方式，你把它直接当成活跃进程数的平均值也没问题。</p>
<p>举个例子，当平均负载为2时意味着什么：</p>
<ul>
<li>在只有2个CPU的系统上，意味着所有CPU刚好被完全占用</li>
<li>在只有4个CPU的系统上，意味着CPU有50%的空闲</li>
<li>在只有1个CPU的系统上，意味着有一半的进程竞争不到CPU</li>
</ul>
<h2 id="平均负载多少合理"><a href="#平均负载多少合理" class="headerlink" title="平均负载多少合理"></a>平均负载多少合理</h2><p>回答这个问题之前我们需要知道系统有几个CPU，可以通过top或者从文件/proc/cpuinfi中读取</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[root@test-monitor-alert-1 ~]# grep &#x27;model name&#x27; /proc/cpuinfo | wc -l<br>4<br></code></pre></td></tr></table></figure>

<p>有了CPU个数就可以判断出当平均负载比CPU个数还打当时候，系统已经出现了过载。那么平均负载的三个数值理解如下：</p>
<ul>
<li>如果1、5、15的三个数值基本相同，或者相差不大，那么说明系统负载很平稳</li>
<li>如果1的值远小于15分钟的值，说明系统最近1分钟负载在减少，过去15分钟内负载很高，反之同理</li>
</ul>
<p>平均负载高于CPU数量70%当时候就需要排查负载高的原因</p>
<h2 id="平均负载与CPU使用率"><a href="#平均负载与CPU使用率" class="headerlink" title="平均负载与CPU使用率"></a>平均负载与CPU使用率</h2><p>在实际工作中我们经常把平均负载与CPU使用率混淆，平均负载是指单位时间内处于可运行状态和不可中断状态的进程数。所以他不仅包括了正在使用的CPU进程，还<br>包括等待CPU和等待I/O的进程。<br>而CPU使用率是单位时间内CPU繁忙情况的统计，跟平均负载并不一定完全对应。</p>
<ul>
<li>CPU密集型进程，使用大量CPU会导致负载升高，此时两者一致</li>
<li>I/O密集型进程，等待I/O会导致平均负载升高，但CPU使用率不一定很高</li>
<li>大量等待CPU的进程调度也会导致平均负载升高，此时CPU使用率也会比较高</li>
</ul>
<p><img src="/images/cpu/%E7%94%B5%E8%AF%9D%E4%BA%AD-Load.png" alt="Linux load">cxsd<br><img src="/images/cpu/%E7%94%B5%E8%AF%9D%E4%BA%AD-CPU%E4%BD%BF%E7%94%A8%E7%8E%87.png" alt="Linux 使用率"></p>
<h2 id="场景分析"><a href="#场景分析" class="headerlink" title="场景分析"></a>场景分析</h2><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><ul>
<li>Linux</li>
<li>stress Linux系统压力测试工具</li>
<li>sysstat 包含了常用的Linux性能工具，用来监控和分析系统性能。mpstat用来实时查看每个CPU的性能指标，以及所有CPU的平均指标。pidstat是一个进程性能分析工具，用来实时查看进程的CPU、内存、I/O以及上下文切换等性能指标</li>
</ul>
<h2 id="CPU密集型进程"><a href="#CPU密集型进程" class="headerlink" title="CPU密集型进程"></a>CPU密集型进程</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 测试之前的数据</span><br>[root@test-monitor-alert-1 ~]# uptime<br> 19:59:55 up 27 days,  2:43,  7 users,  load average: 0.05, 0.07, 0.11<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 模拟两个CPU使用率100%</span><br>[root@test-monitor-alert-1 ~]# stress --cpu 2 --timeout 600<br>stress: info: [12880] dispatching hogs: 2 cpu, 0 io, 0 vm, 0 hdd<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> uptime查看平均负载变化情况</span><br>[root@test-monitor-alert-1 ~]# watch -d uptime<br>Every 2.0s: uptime                                                                                                     Tue Nov 24 20:03:27 2020<br><br> 20:03:27 up 27 days,  2:47,  7 users,  load average: 1.98, 0.97, 0.45<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mpstat查看CPU使用情况  -P ALL 表示监控所有CPU，后面数字5表示间隔5秒后输出一组数据</span><br>[root@test-monitor-alert-1 sysstat-11.6.5]# ./mpstat -P ALL  5<br>Linux 3.10.0-1127.19.1.el7.x86_64 (test-monitor-alert-1) 	11/25/2020 	_x86_64_	(4 CPU)<br><br>09:26:34 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>09:26:39 AM  all    0.35    0.00    2.17   81.48    0.00    0.00    0.00    0.00    0.00   15.99<br>09:26:39 AM    0    0.40    0.00    1.82   57.17    0.00    0.00    0.00    0.00    0.00   40.61<br>09:26:39 AM    1    0.40    0.00    4.23   83.30    0.00    0.00    0.00    0.00    0.00   12.07<br>09:26:39 AM    2    0.40    0.00    1.01   90.30    0.00    0.00    0.00    0.00    0.00    8.28<br>09:26:39 AM    3    0.20    0.00    1.41   95.35    0.00    0.00    0.00    0.00    0.00    3.03<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 到底是哪个进程导致了 CPU 使用率为 100% 呢？你可以使用 pidstat 来查询：</span><br><span class="hljs-meta">#</span><span class="bash"> 间隔5秒后输出一组数据</span><br><br>[root@test-monitor-farseer-1 sysstat-11.6.5]# dstat --top-io -d --top-bio -l<br>----most-expensive---- -dsk/total- ----most-expensive---- ---load-avg---<br>     i/o process      | read  writ|  block i/o process   | 1m   5m  15m<br>docker-cont4376B 1002k|  16k   99k|systemd    9524B   58k|0.18 0.70 0.59<br><br>prometheus   11k   11k|   0  1196k|prometheus    0  8192B|0.18 0.70 0.59<br>barad_agent  42k   10k|8192B    0 |barad_agent   0    12k|0.16 0.69 0.59<br>process-exp1462k   16k|  24k  320k|systemd-jou   0   260k|0.16 0.69 0.59<br>stress-ng     0   744M|4792k  114M|stress-ng     0   744M|0.16 0.69 0.59<br>stress-ng  1024M  281M|8192B  106M|stress-ng     0   280M|0.16 0.69 0.59<br>barad_agent  23k 2367B|8192B  114M|prometheus    0  4096B|0.16 0.69 0.59<br>YDService  9524B 1447B|  12k  111M|jbd2/vda1-8   0    28k|0.63 0.78 0.62<br>systemd-jou  31k    0 |  12k   96M|systemd-jou   0   172k|0.63 0.78 0.62<br>barad_agent4010B 2535B|  12k  111M|barad_agent   0  4096B|0.63 0.78 0.62<br>YDService  6380B    0 |4096B  115M|jbd2/vda1-8   0    16k|0.63 0.78 0.62<br>prometheus   11k   11k|  20k  104M|YDService    12k    0 |0.63 0.78 0.62<br>barad_agent  42k   10k|8192B  107M|YDService    12k    0 |0.90 0.83 0.64<br>stress-ng  1024M 1024M|  24k  108M|stress-ng     0  1024M|0.90 0.83 0.64<br>YDService  4971B  164B|8192B  104M|prometheus    0  4096B|0.90 0.83 0.64<br>systemd-jou6478B    0 |4096B  107M|systemd-jou   0    56k|0.90 0.83 0.64<br>node_export  44k   11k|  16k  108M|jbd2/vda1-8   0   136k|0.90 0.83 0.64<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> pidsta版本问题，抓不出io <span class="hljs-built_in">wait</span></span><br>[root@test-monitor-farseer-1 sysstat-11.6.5]# ./pidstat -u 5 1<br>Linux 3.10.0-1127.19.1.el7.x86_64 (test-monitor-farseer-1) 	12/01/2020 	_x86_64_	(4 CPU)<br><br>03:42:58 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>03:43:03 PM     0         9    0.00    0.20    0.00    0.20    0.20     1  rcu_sched<br>03:43:03 PM     0        14    0.00    0.20    0.00    0.00    0.20     1  ksoftirqd/1<br>03:43:03 PM     0        24    0.00    0.20    0.00    0.00    0.20     3  ksoftirqd/3<br>03:43:03 PM     0       184    0.00    0.20    0.00    0.00    0.20     1  kauditd<br>03:43:03 PM     0      1347    0.00    0.20    0.00    0.00    0.20     1  dockerd<br>03:43:03 PM  1000      2066    1.20    1.20    0.00    0.00    2.40     0  java<br>03:43:03 PM 65534      2525    0.20    0.00    0.00    0.00    0.20     1  prometheus<br>03:43:03 PM     0      4926    0.20    0.00    0.00    0.00    0.20     2  docker-proxy<br>03:43:03 PM     0      4950    0.00    0.40    0.00    0.00    0.40     3  etcd<br>03:43:03 PM     0      5317    0.00    0.20    0.00    0.20    0.20     1  fs-monitor<br>03:43:03 PM     0      9761  100.00    0.00    0.00    0.00  100.00     0  stress<br>03:43:03 PM     0      9762   99.80    0.00    0.00    0.00   99.80     2  stress<br>03:43:03 PM     0      9780    0.00    0.20    0.00    0.00    0.20     3  pidstat<br>03:43:03 PM     0     26236    0.20    0.20    0.00    0.00    0.40     0  barad_agent<br>03:43:03 PM     0     28925    0.00    0.40    0.00    0.00    0.40     1  YDService<br>03:43:03 PM     0     28985    0.20    0.20    0.00    0.00    0.40     3  YDEdr<br><span class="hljs-meta">#</span><span class="bash"> 从这里可以明显看到，stress 进程的 CPU 使用率为 100%。</span><br></code></pre></td></tr></table></figure>

<h2 id="IO密集型"><a href="#IO密集型" class="headerlink" title="IO密集型"></a>IO密集型</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 测试之前的数据</span><br>[root@test-monitor-alert-1 ~]# uptime<br> 09:25:35 up 27 days,  3:21,  8 users,  load average: 0.35, 0.94, 0.60<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 模拟IO打满</span><br>[root@test-monitor-alert-1 ~]#  stress-ng -i 1 --hdd 1 --timeout 600<br>stress-ng: info:  [4710] dispatching hogs: 1 hdd, 1 io<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> uptime查看平均负载变化情况</span><br>[root@test-monitor-alert-1 ~]# watch -d uptime<br>Every 2.0s: uptime                                                                                                     Wed Nov 25 09:25:38 2020<br><br> 09:25:38 up 27 days, 16:09,  4 users,  load average: 2.49, 0.69, 0.27<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> mpstat查看CPU使用情况  -P ALL 表示监控所有CPU，后面数字5表示间隔5秒后输出一组数据</span><br>[root@test-monitor-alert-1 ~]# mpstat -P ALL  5<br>Linux 3.10.0-1127.19.1.el7.x86_64 (test-monitor-alert-1) 	11/24/2020 	_x86_64_	(4 CPU)<br><br>08:45:14 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>08:45:19 PM  all    0.75    0.00    1.86   89.53    0.00    0.00    0.00    0.00    0.00    7.85<br>08:45:19 PM    0    0.61    0.00    2.42   91.92    0.00    0.00    0.00    0.00    0.00    5.05<br>08:45:19 PM    1    0.80    0.00    2.20   76.15    0.00    0.00    0.00    0.00    0.00   20.84<br>08:45:19 PM    2    0.81    0.00    1.21   92.74    0.00    0.00    0.00    0.00    0.00    5.24<br>08:45:19 PM    3    0.80    0.00    1.41   97.59    0.00    0.00    0.00    0.00    0.00    0.20<br></code></pre></td></tr></table></figure>


<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 使用 pidstat 来查询到底是哪个进程导致了iowait这么高</span><br><span class="hljs-meta">#</span><span class="bash"> 间隔5秒后输出一组数据</span><br>[root@test-monitor-alert-1 sysstat-11.6.5]# ./pidstat -u 5 1<br>Linux 3.10.0-1127.19.1.el7.x86_64 (test-monitor-alert-1) 	11/25/2020 	_x86_64_	(4 CPU)<br><br>Average:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>Average:        0       275    0.00    0.60    0.00    0.00    0.60     -  kworker/0:1H<br>Average:        0       292    0.00    2.60    0.00    0.00    2.60     -  jbd2/vda1-8<br>Average:        0      1347    0.20    0.20    0.00    0.00    0.40     -  dockerd<br>Average:        0      1472    0.40    0.20    0.00    0.00    0.60     -  node_exporter<br>Average:        0      1598    0.00    0.20    0.00    0.00    0.20     -  docker-containe<br>Average:     1000      2066    1.00    1.40    0.00    0.00    2.40     -  java<br>Average:        0      4950    0.00    0.80    0.00    0.00    0.80     -  etcd<br>Average:        0      5885    0.00   17.00    0.00    0.00   17.00     -  stress-ng-hdd<br>Average:        0      5886    0.00    0.40    0.00    0.00    0.40     -  stress-ng-io<br>Average:        0      5887    0.00    0.20    0.00    0.00    0.20     -  stress-ng-io<br>Average:        0      8118    0.20    0.00    0.00    0.00    0.20     -  java<br>Average:        0      8449    0.00    1.80    0.00    0.20    1.80     -  kworker/u8:0<br>Average:        0      8458    0.20    0.20    0.00    0.00    0.40     -  java<br>Average:        0     17111    0.00    0.20    0.00    0.20    0.20     -  kworker/3:0<br>Average:        0     26173    0.00    0.20    0.00    0.00    0.20     -  notify<br>Average:        0     26236    0.00    0.20    0.00    0.00    0.20     -  barad_agent<br>Average:        0     28985    0.00    1.60    0.00    0.00    1.60     -  YDEdr<br></code></pre></td></tr></table></figure>

<h2 id="大量进程"><a href="#大量进程" class="headerlink" title="大量进程"></a>大量进程</h2><p>当系统中运行进程超出 CPU 运行能力时，就会出现等待 CPU 的进程。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 测试之前的数据</span><br>[root@test-monitor-alert-1 ~]# uptime<br> 09:44:17 up 27 days, 16:28,  4 users,  load average: 0.02, 1.90, 2.54<br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 模拟多进程</span><br>[root@test-monitor-alert-1 ~]# stress -c 8 --timeout 600<br>stress: info: [9683] dispatching hogs: 8 cpu, 0 io, 0 vm, 0 hdd<br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> uptime查看平均负载变化情况</span><br><span class="hljs-meta">#</span><span class="bash"> 由于系统只有 4 个 CPU，明显比 8 个进程要少得多，因而，系统的 CPU 处于严重过载状态，平均负载高达 8.08</span><br>[root@test-monitor-alert-1 ~]# watch -d uptime<br>Every 2.0s: uptime                                                                                                     Wed Nov 25 09:47:07 2020<br><br> 09:47:08 up 27 days, 16:31,  4 users,  load average: 8.08, 3.72, 3.05<br></code></pre></td></tr></table></figure>


<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 使用 pidstat 来看一下进程的情况</span><br><span class="hljs-meta">#</span><span class="bash"> 间隔5秒后输出一组数据</span><br>[root@test-monitor-alert-1 sysstat-11.6.5]# ./pidstat -u 5 1<br>Linux 3.10.0-1127.19.1.el7.x86_64 (test-monitor-alert-1) 	11/25/2020 	_x86_64_	(4 CPU)<br><br>09:47:44 AM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>09:47:49 AM  1000      2066    1.59    0.20    0.00    0.00    1.79     0  java<br>09:47:49 AM 65534      2525    0.20    0.00    0.00    0.00    0.20     1  prometheus<br>09:47:49 AM     0      4950    0.20    0.20    0.00    1.39    0.40     2  etcd<br>09:47:49 AM     0      8118    0.00    0.20    0.00    0.00    0.20     0  java<br>09:47:49 AM     0      8458    0.20    0.00    0.00    0.00    0.20     1  java<br>09:47:49 AM     0      9290    0.20    0.00    0.00    0.20    0.20     3  watch<br>09:47:49 AM     0      9684   64.94    0.00    0.00   34.66   64.94     2  stress<br>09:47:49 AM     0      9685   40.24    0.00    0.00   59.56   40.24     1  stress<br>09:47:49 AM     0      9686   44.02    0.00    0.00   55.58   44.02     2  stress<br>09:47:49 AM     0      9687   46.81    0.00    0.00   52.79   46.81     0  stress<br>09:47:49 AM     0      9688   41.43    0.00    0.00   58.37   41.43     1  stress<br>09:47:49 AM     0      9689   49.00    0.00    0.00   50.20   49.00     0  stress<br>09:47:49 AM     0      9690   55.58    0.00    0.00   44.42   55.58     3  stress<br>09:47:49 AM     0      9691   52.59    0.00    0.00   47.41   52.59     2  stress<br>09:47:49 AM     0     26155    0.00    0.20    0.00    0.00    0.20     0  docker-containe<br>09:47:49 AM     0     26236    0.20    0.20    0.00    0.00    0.40     2  barad_agent<br>09:47:49 AM   999     28742    0.20    0.00    0.00    0.00    0.20     1  mysqld<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 可以看出，8 个进程在争抢 4 个 CPU，每个进程等待 CPU 的时间（也就是代码块中的 %<span class="hljs-built_in">wait</span> 列）高达 50%。这些超出 CPU 计算能力的进程，最终导致 CPU 过载。</span><br></code></pre></td></tr></table></figure>

<pre><code>平均负载高有可能是 CPU 密集型进程导致的；
平均负载高并不一定代表 CPU 使用率高，还有可能是 I/O 更繁忙了；
当发现负载高的时候，可以使用 mpstat、pidstat 等工具，辅助分析负载的来源
</code></pre>
<h2 id="CPU寄存器、程序计数器：CPU上下文"><a href="#CPU寄存器、程序计数器：CPU上下文" class="headerlink" title="CPU寄存器、程序计数器：CPU上下文"></a>CPU寄存器、程序计数器：CPU上下文</h2><p>CPU寄存器是CPU中内置的容量小、速度极快的内存。<br>程序计数器用来存储CPU正在执行的指令位置、或者即将执行的下一条指令的位置。他们都是CPU在运行任何任务前必须依赖的环境，因此也可以称作CPU上下文。</p>
<ul>
<li>PC</li>
<li>IR</li>
<li>PSR</li>
</ul>
<p><img src="/images/cpu/CPU%E5%B7%A5%E4%BD%9C%E5%9B%BE.png" alt="CPU上下文"></p>
<h1 id="CPU上下文切换"><a href="#CPU上下文切换" class="headerlink" title="CPU上下文切换"></a>CPU上下文切换</h1><p>进程在竞争CPU的时候并未真正运行，导致系统负载过高的原因就是CPU上下文切换。<br>Linux 是一个多任务操作系统，它支持远大于 CPU 数量的任务同时运行。当然，这些任务实际上并不是真的在同时运行，而是因为系统在很短的时间内，将 CPU 轮流分配给它们，造成多任务同时运行的错觉。<br>在任务运行前CPU都需要知道任务从哪里加载、从哪里运行，简单来说CPU需要系统事先帮它设置好CPU寄存器和程序计数器。</p>
<p>CPU上下文切换就是包前一个任务的CPU上下文保存起来，然后加载新任务的上下文到这些寄存器和程序计数器，然后跳转到程序计数器所指的新位置运行新任务。</p>
<h2 id="进程上下文切换"><a href="#进程上下文切换" class="headerlink" title="进程上下文切换"></a>进程上下文切换</h2><p>Linux 按照特权等级，把进程的运行空间分为内核空间和用户空间，分别对应着下图中， CPU 特权等级的 Ring 0 和 Ring 3。如图：</p>
<p><img src="/images/cpu/%E7%89%B9%E6%9D%83%E7%AD%89%E7%BA%A7.png" alt="特权等级"></p>
<ul>
<li>内核空间（Ring 0）具有最高权限，可以直接访问所有资源；</li>
<li>用户空间（Ring 3）只能访问受限资源，不能直接访问内存等硬件设备，必须通过系统调用陷入到内核中，才能访问这些特权资源。</li>
</ul>
<p>进程既可以在用户空间（用户态）运行又可以在内核（内核态）空间运行。进程从用户态到内核态到转变需要通过<code>系统调用</code>来完成。<br>在系统调用到过程中CPU发生了上下文切换。</p>
<p><code>CPU 寄存器里原来用户态的指令位置，需要先保存起来。接着，为了执行内核态代码，CPU 寄存器需要更新为内核态指令的新位置。最后才是跳转到内核态运行内核任务。而系统调用结束后，CPU 寄存器需要恢复原来保存的用户态，然后再切换到用户空间，继续运行进程。所以，一次系统调用的过程，其实是发生了两次 CPU 上下文切换。</code></p>
<pre><code>系统调用过程中，并不涉及虚拟内存等进程用户态的资源，也不会切换进程。所以这里的切换和进程切换是有区别的：
1. 进程上下文切换是从一个进程切换到另一个进程
2. 系统调用过程中，始终在同一个进程在运行。
</code></pre>
<p>所以系统调用是一种特权模式的切换。</p>
<h2 id="进程调度和系统调用区别"><a href="#进程调度和系统调用区别" class="headerlink" title="进程调度和系统调用区别"></a>进程调度和系统调用区别</h2><p>进程由内核管理和调度的，所以进程切换是发生在内核态的。进程的上下文不仅包括了内存、堆栈等，还包含了内核堆栈、寄存器等内核空的状态。<br>所以进程上下文切换比系统调用多了一步，<code>在保存当前进程的内核状态和 CPU 寄存器之前，需要先把该进程的虚拟内存、栈等保存下来；而加载了下一进程的内核态后，还需要刷新进程的虚拟内存和用户栈</code>。 如图：</p>
<p><img src="/images/cpu/%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2.png" alt="CPU上下文"></p>
<h2 id="什么时候会进行上下文切换"><a href="#什么时候会进行上下文切换" class="headerlink" title="什么时候会进行上下文切换"></a>什么时候会进行上下文切换</h2><ul>
<li>进程时间片耗尽就会被系统挂起，切换到其它等待进程（为了保证进程公平调度，CPU的时间被划分为一段段时间片，轮流分配给各个进程）</li>
<li>进程资源不足时，要等到资源满足才可以运行，这个时候进程也会被挂起</li>
<li>进程通过睡眠函数sleep将自己挂起时，也会发生调度</li>
<li>有优先级更高的进程运行时，为了保证高优先级进程的运行，当前进程可能被挂起</li>
<li>发生硬件中断的时候，CPU上的进程也会被挂起，来执行内核中断服务</li>
</ul>
<p>进程切换的时候会发生上下文恰换，Linux为每个CPU都维护了一个就绪队列，将活跃进程按照优先级和等待CPU的时间排序，选择最需要CPU的进程，也就是优先级和等待CPU时间最长的进程来运行。下面整理来几种进程切换的场景：</p>
<h2 id="线程上下文切换"><a href="#线程上下文切换" class="headerlink" title="线程上下文切换"></a>线程上下文切换</h2><p>线程是调度的基本单位，而进程则是资源拥有的基本单位。<code>内核的任务调度实际上是对线程的调度，进程只是为线程提供了虚拟内存、全局变量等资源</code>。</p>
<ul>
<li>当进程只有一个线程的时候，进程对于线程</li>
<li>当进程拥有多个线程时，共享虚拟内存、全局变量等资源，这些数据在上下文切换时不需保存</li>
<li>多个线程各自拥有自己的私有数据，上下文切换时时需要保存的</li>
</ul>
<h2 id="中断上下文切换"><a href="#中断上下文切换" class="headerlink" title="中断上下文切换"></a>中断上下文切换</h2><p>中断是为了快速响应硬件的事件，中断的优先级比进程高，对被打断对进程来说，需要将当前状态保存下来，以便之后进程恢复运行。<br>和进程上下文不同，中断上下文切换并不涉及到进程的用户态。所以，即便中断过程打断了一个正处在用户态的进程，也不需要保存和恢复这个进程的虚拟内存、全局变量等用户态资源。中断上下文，其实只包括内核态中断服务程序执行所必需的状态，包括CPU寄存器、内核堆栈、硬件中断参数等。</p>
<h2 id="查看系统上下文切换"><a href="#查看系统上下文切换" class="headerlink" title="查看系统上下文切换"></a>查看系统上下文切换</h2><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 每隔5秒输出1组数据</span><br>[root@test-tke-node-k21 ~]# vmstat 5<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 0  1      0 16538480 238900 12508012    0    0     5   166    0    0  6  6 88  0  0<br> 0  0      0 16540000 238900 12508004    0    0     0   258 11200 18214  6  2 92  0  0<br> 0  0      0 16542944 238900 12508124    0    0     0   273 11778 19454  7  2 92  0  0<br></code></pre></td></tr></table></figure>

<ul>
<li>cs（context switch）是每秒上下文切换的次数</li>
<li>in（interrupt）则是每秒中断的次数</li>
<li>r（Running or Runnable）是就绪队列的长度，也就是正在运行和等待 CPU 的进程数</li>
<li>b（Blocked）则是处于不可中断睡眠状态的进程数</li>
</ul>
<h3 id="Procs（进程）："><a href="#Procs（进程）：" class="headerlink" title="Procs（进程）："></a>Procs（进程）：</h3><ul>
<li>r: 运行队列中进程数量</li>
<li>b： 等待IO的进程数量</li>
</ul>
<h3 id="Memory（内存）："><a href="#Memory（内存）：" class="headerlink" title="Memory（内存）："></a>Memory（内存）：</h3><ul>
<li>swpd: 使用虚拟内存大小</li>
<li>free: 可用内存大小</li>
<li>buff: 用作缓冲的内存大小</li>
<li>cache: 用作缓存的内存大小</li>
</ul>
<h3 id="Swap："><a href="#Swap：" class="headerlink" title="Swap："></a>Swap：</h3><ul>
<li>si: 每秒从交换区写到内存的大小</li>
<li>so: 每秒写入交换区的内存大小</li>
</ul>
<h3 id="IO：（现在的Linux版本块的大小为1024bytes）"><a href="#IO：（现在的Linux版本块的大小为1024bytes）" class="headerlink" title="IO：（现在的Linux版本块的大小为1024bytes）"></a>IO：（现在的Linux版本块的大小为1024bytes）</h3><ul>
<li>bi: 每秒读取的块数</li>
<li>bo: 每秒写入的块数</li>
</ul>
<h3 id="系统："><a href="#系统：" class="headerlink" title="系统："></a>系统：</h3><ul>
<li>in: 每秒中断数，包括时钟中断。【interrupt】</li>
<li>cs: 每秒上下文切换数。        【count/second】</li>
</ul>
<h3 id="CPU（以百分比表示）："><a href="#CPU（以百分比表示）：" class="headerlink" title="CPU（以百分比表示）："></a>CPU（以百分比表示）：</h3><ul>
<li>us: 用户进程执行时间(user time)</li>
<li>sy: 系统进程执行时间(system time)</li>
<li>id: 空闲时间(包括IO等待时间),中央处理器的空闲时间 。以百分比表示。</li>
<li>wa: 等待IO时间</li>
</ul>
<h3 id="查看每个进程上下文切换的情况"><a href="#查看每个进程上下文切换的情况" class="headerlink" title="查看每个进程上下文切换的情况"></a>查看每个进程上下文切换的情况</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 每隔5秒输出1组数据</span><br>[root@test-tke-node-k21 ~]# pidstat -w 5<br>Linux 4.14.105-19-0012 (test-tke-node-k21) 	11/30/2020 	_x86_64_	(16 CPU)<br><br>08:26:23 PM   UID       PID   cswch/s nvcswch/s  Command<br>08:26:28 PM     0         1      1.39      0.00  systemd<br>08:26:28 PM     0       408      2.39      0.00  jbd2/vda1-8<br>08:26:28 PM     0       821      1.00      0.00  auditd<br>08:26:28 PM    81       851      2.19      0.00  dbus-daemon<br>08:26:28 PM     0       854     81.67      0.00  systemd-logind<br>08:26:28 PM     0      2603     17.73      0.00  xfsaild/vdb<br>08:26:28 PM     0      5856      0.40      0.00  ip-masq-agent<br>08:26:28 PM     0    176333      0.20      0.00  docker-containe<br>08:26:28 PM    99    247899      1.39      0.00  dnsmasq<br>08:26:28 PM  1000    818340      1.79      0.00  php-fpm<br>08:26:28 PM  1000    818678      0.20      0.00  php-fpm<br>08:26:28 PM     0    879677      1.99      0.00  wukong-go<br>08:26:28 PM     0    879734      0.40      0.00  wukong-go<br>08:26:28 PM     0   1133084      0.20      0.00  docker-containe<br>08:26:28 PM     0   1322604     79.68      4.58  kube-proxy<br>08:26:28 PM     0   1396221      0.20      0.00  log-collector<br>08:26:28 PM     0   1396237      1.99      0.00  fluentd<br>08:26:28 PM     0   1396247      3.19      0.00  ruby<br></code></pre></td></tr></table></figure>

<ul>
<li>cswch表示每秒自愿上下文切换（voluntary context switches）的次数(自愿上下文切换，指进程无法获取所需资源，导致的上下文切换。比如说， I/O、内存等系统资源不足时，就会发生自愿上下文切换。（当某一任务处于阻塞等待时等等）)</li>
<li>nvcswch表示每秒非自愿上下文切换（non voluntary context switches）的次数（非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换。比如说，大量进程都在争抢 CPU 时，就容易发生非自愿上下文切换）</li>
</ul>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 间隔1秒后输出1组数据</span><br>[root@test-tke-node-k21 ~]# vmstat 1 1<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 0  0      0 16466196 238908 12583356    0    0     5   166    0    0  6  6 88  0  0<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 以10个线程运行5分钟的基准测试，模拟多线程切换的问题</span><br>[root@test-tke-node-k21 ~]# sysbench --threads=10 --max-time=300 threads run<br>WARNING: --max-time is deprecated, use --time instead<br>sysbench 1.0.17 (using system LuaJIT 2.0.4)<br><br>Running the test with following options:<br>Number of threads: 10<br>Initializing random number generator from current time<br><br><br>Initializing worker threads...<br><br>Threads started!<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">[root@test-tke-node-k21 ~]# vmstat 1<br><span class="hljs-meta">#</span><span class="bash"> 每隔1秒输出1组数据</span><br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>14  0      0 16321480 239636 12712368    0    0     5   166    0    0  6  6 88  0  0<br> 9  0      0 16322324 239636 12712316    0    0     0     0 180878 783183 16 36 48  0  0<br>10  0      0 16322848 239636 12712316    0    0     0   524 95575 820357 16 35 49  0  0<br>10  0      0 16322512 239636 12712500    0    0     0   488 101780 821691 14 37 49  0  0<br>12  0      0 16322304 239636 12712332    0    0     0   116 118060 804412 20 36 44  0  0<br> 9  0      0 16322612 239636 12712408    0    0     0     0 159525 754018 22 36 42  0  0<br>11  0      0 16307728 239636 12712464    0    0     0   524 88452 829684 15 36 49  0  0<br> 8  0      0 16324056 239636 12712364    0    0     0     0 96059 826541 15 36 49  0  0<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 每隔1秒输出1组数据（需要 Ctrl+C 才结束）</span><br><span class="hljs-meta">#</span><span class="bash"> -w参数表示输出进程切换指标，而-u参数则表示输出CPU使用指标</span><br>[root@test-tke-node-k21 ~]# pidstat -w -u 1<br>Linux 4.14.105-19-0012 (test-tke-node-k21) 	11/30/2020 	_x86_64_	(16 CPU)<br><br>09:04:51 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>09:04:52 PM     0         1    0.00    0.98    0.00    0.98    15  systemd<br>09:04:52 PM     0       854    0.98    0.00    0.00    0.98     6  systemd-logind<br>09:04:52 PM     0      3475    1.96    0.00    0.00    1.96     8  dockerd<br>09:04:52 PM     0      3488    0.00    0.98    0.00    0.98    14  docker-containe<br>09:04:52 PM     0      3581    2.94    0.00    0.00    2.94     6  kubelet<br>09:04:52 PM     0    153780  100.00  100.00    0.00  100.00    11  sysbench<br>09:04:52 PM     0    154330    0.00    1.96    0.00    1.96     7  pidstat<br>09:04:52 PM     0   1741126    0.00    0.98    0.00    0.98     9  wukong-go<br>09:04:52 PM     0   1847481    0.98    0.00    0.00    0.98     7  wukong-go<br>09:04:52 PM     0   1968378    0.98    0.00    0.00    0.98     8  wukong-go<br>09:04:52 PM     0   2035882    0.98    0.00    0.00    0.98     7  YDEdr<br>09:04:52 PM     0   2245987    0.00    0.98    0.00    0.98    10  wukong-go<br>09:04:52 PM     0   2491812    0.98    0.00    0.00    0.98     7  barad_agent<br>09:04:52 PM     0   2726307    0.98    0.00    0.00    0.98     1  wukong-go<br>09:04:52 PM     0   2726406    0.00    0.98    0.00    0.98     9  docker-containe<br>09:04:52 PM     0   3205475    5.88    0.00    0.00    5.88     9  wukong-go<br><br>09:04:51 PM   UID       PID   cswch/s nvcswch/s  Command<br>09:04:52 PM     0         1      1.96      0.00  systemd<br>09:04:52 PM     0         7      6.86      0.00  ksoftirqd/0<br>09:04:52 PM     0         8    128.43      0.00  rcu_sched<br>09:04:52 PM     0        10      0.98      0.00  migration/0<br>09:04:52 PM     0        11      0.98      0.00  watchdog/0<br>09:04:52 PM     0        14      0.98      0.00  watchdog/1<br>09:04:52 PM     0        16      2.94      0.00  ksoftirqd/1<br>09:04:52 PM     0        20      0.98      0.00  watchdog/2<br>09:04:52 PM     0        22      0.98      0.00  ksoftirqd/2<br>09:04:52 PM     0        26      0.98      0.00  watchdog/3<br>09:04:52 PM     0        28      0.98      0.00  ksoftirqd/3<br>09:04:52 PM     0        32      0.98      0.00  watchdog/4<br>09:04:52 PM     0        33      0.98      0.00  migration/4<br>09:04:52 PM     0        38      0.98      0.00  watchdog/5<br>09:04:52 PM     0        44      0.98      0.00  watchdog/6<br>09:04:52 PM     0        46      0.98      0.00  ksoftirqd/6<br>09:04:52 PM     0        50      0.98      0.00  watchdog/7<br>09:04:52 PM     0        56      0.98      0.00  watchdog/8<br>09:04:52 PM     0        58      0.98      0.00  ksoftirqd/8<br>09:04:52 PM     0        64      0.98      0.00  ksoftirqd/9<br>09:04:52 PM     0        70      0.98      0.00  ksoftirqd/10<br>09:04:52 PM     0        76      1.96      0.00  ksoftirqd/11<br>09:04:52 PM     0        88     11.76      0.00  ksoftirqd/13<br>09:04:52 PM     0        94     14.71      0.00  ksoftirqd/14<br>09:04:52 PM     0       100      4.90      0.00  ksoftirqd/15<br>09:04:52 PM   998       846      0.98      0.00  lsmd<br>09:04:52 PM    81       851      1.96      0.00  dbus-daemon<br>09:04:52 PM     0       854     82.35      0.00  systemd-logind<br>09:04:52 PM     0      2603     17.65      0.00  xfsaild/vdb<br>09:04:52 PM     0      5856      0.98      0.00  ip-masq-agent<br>09:04:52 PM     0     40848      1.96      0.00  kworker/9:0<br>09:04:52 PM     0     54827      3.92      0.00  kworker/8:3<br>09:04:52 PM     0     63763      1.96      0.00  kworker/13:1<br>09:04:52 PM     0     77632      1.96      0.00  kworker/2:0<br>09:04:52 PM     0     90968      4.90      0.00  kworker/11:2<br>09:04:52 PM     0     95640      1.96      0.00  kworker/4:1<br>09:04:52 PM     0    109150      0.98      0.00  kworker/6:1<br>09:04:52 PM     0    109261      2.94      0.00  kworker/12:1<br>09:04:52 PM     0    113800      3.92      0.00  kworker/5:3<br>09:04:52 PM     0    116666      2.94      0.00  kworker/1:0<br>09:04:52 PM     0    125144      9.80      0.00  kworker/3:1<br>09:04:52 PM     0    127807      4.90      0.00  kworker/7:0<br>09:04:52 PM     0    132114      8.82      0.00  kworker/0:1<br>09:04:52 PM     0    141303      6.86      0.00  kworker/15:0<br>09:04:52 PM    89    146085      0.98      0.00  trivial-rewrite<br>09:04:52 PM     0    146091      1.96      0.00  kworker/14:0<br>09:04:52 PM     0    149169      8.82      0.00  kworker/10:1<br>09:04:52 PM     0    154330      0.98      0.00  pidstat<br>09:04:52 PM    99    247899      1.96      0.00  dnsmasq<br>09:04:52 PM  1000    818340      0.98      0.00  php-fpm<br>09:04:52 PM     0   1396237      1.96      0.00  fluentd<br>09:04:52 PM     0   1396247      2.94      0.00  ruby<br>09:04:52 PM     0   2035882      0.98      0.00  YDEdr<br>09:04:52 PM     0   2491811      2.94      0.00  barad_agent<br>09:04:52 PM     0   2522357      4.90      0.00  wukong-go<br>09:04:52 PM     0   2726406      0.98      0.00  docker-containe<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> -wt 参数表示输出线程的上下文切换指标</span><br>[root@test-tke-node-k21 ~]# pidstat -wt -u 1 | grep sysbench<br>[root@test-tke-node-k21 ~]# pidstat -wt -u 1<br>Linux 4.14.105-19-0012 (test-tke-node-k21) 	11/30/2020 	_x86_64_	(16 CPU)<br><br>10:31:49 PM   UID      TGID       TID    %usr %system  %guest    %CPU   CPU  Command<br>10:31:50 PM     0         1         -    0.90    0.00    0.00    0.90     1  systemd<br>10:31:50 PM     0    548753         -  100.00  100.00    0.00  100.00    11  sysbench<br>10:31:50 PM     0         -    548754   27.03   64.86    0.00   91.89    10  |__sysbench<br>10:31:50 PM     0         -    548755   27.93   63.96    0.00   91.89     5  |__sysbench<br>10:31:50 PM     0         -    548756   32.43   60.36    0.00   92.79     2  |__sysbench<br>10:31:50 PM     0         -    548757   23.42   68.47    0.00   91.89    11  |__sysbench<br>10:31:50 PM     0         -    548758   25.23   67.57    0.00   92.79     6  |__sysbench<br>10:31:50 PM     0         -    548759   24.32   67.57    0.00   91.89     7  |__sysbench<br>10:31:50 PM     0         -    548760   24.32   67.57    0.00   91.89    13  |__sysbench<br>10:31:50 PM     0         -    548761   27.03   65.77    0.00   92.79     4  |__sysbench<br>10:31:50 PM     0         -    548762   23.42   68.47    0.00   91.89    12  |__sysbench<br>10:31:50 PM     0         -    548763   25.23   65.77    0.00   90.99     3  |__sysbench<br><br>Average:      UID      TGID       TID   cswch/s nvcswch/s  Command<br>Average:        0         -    548754  37902.70     15.32  |__sysbench<br>Average:        0         -    548755  39209.01     27.93  |__sysbench<br>Average:        0         -    548756  38840.54     26.13  |__sysbench<br>Average:        0         -    548757  41057.66      8.11  |__sysbench<br>Average:        0         -    548758  38201.80     15.32  |__sysbench<br>Average:        0         -    548759  41139.64      6.31  |__sysbench<br>Average:        0         -    548760  37354.05     69.37  |__sysbench<br>Average:        0         -    548761  39441.44     17.12  |__sysbench<br>Average:        0         -    548762  38177.48     28.83  |__sysbench<br>Average:        0         -    548763  41107.21     40.54  |__sysbench<br>Average:        0    549036         -      0.90      1.80  pidstat<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> ....</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 观察中断的变化情况</span><br>[root@test-tke-node-k21 ~]# watch -d cat /proc/interrupts<br><span class="hljs-meta">#</span><span class="bash"> cat /proc/interrupts</span><br><span class="hljs-meta">#</span><span class="bash"> 从左至右：中断号   中断次数  中断设备名称</span><br><span class="hljs-meta">#</span><span class="bash"> 如下图</span><br><span class="hljs-meta">#</span><span class="bash"> ...</span><br><br></code></pre></td></tr></table></figure>
<p><img src="/images/cpu/interrupts.jpg" alt="中断观察"></p>
<p>重调度中断（RES），这个中断类型表示，唤醒空闲状态的 CPU 来调度新的任务运行。这是多处理器系统（SMP）中，调度器用来分散任务到不同 CPU 的机制，通常也被称为处理器间中断（Inter-Processor Interrupts，IPI）。</p>
<ul>
<li>自愿上下文切换变多了，说明进程都在等待资源，有可能发生了 I/O 等其他问题</li>
<li>非自愿上下文切换变多了，说明进程都在被强制调度，也就是都在争抢 CPU，说明 CPU 的确成了瓶颈</li>
<li>中断次数变多了，说明 CPU 被中断处理程序占用，还需要通过查看 /proc/interrupts 文件来分析具体的中断类型。</li>
</ul>
<h1 id="CPU-100-之后该怎么办"><a href="#CPU-100-之后该怎么办" class="headerlink" title="CPU 100%之后该怎么办"></a>CPU 100%之后该怎么办</h1><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 能够实时显示占用 CPU 时钟最多的函数或者指令，因此可以用来查找热点函数</span><br>[root@test-tke-node-k21 ~]# perf top<br><span class="hljs-meta">#</span><span class="bash">  perf top -g 开启调用关系的采样，方便根据调用链来分析性能问题</span><br>Samples: 157K of event &#x27;cpu-clock&#x27;, Event count (approx.): 35995554317<br>Overhead  Shared Object           Symbol                                                                                                    ◆<br>  18.11%  [kernel]                [k] _raw_spin_unlock_irqrestore                                                                           ▒<br>  14.61%  [kernel]                [k] __sched_text_start                                                                                    ▒<br>  12.29%  [kernel]                [k] do_syscall_64                                                                                         ▒<br>   9.64%  libc-2.17.so            [.] __sched_yield                                                                                         ▒<br>   7.43%  libpthread-2.17.so      [.] pthread_mutex_unlock                                                                                  ▒<br>   7.34%  [kernel]                [k] finish_task_switch                                                                                    ▒<br>   2.41%  libpthread-2.17.so      [.] pthread_mutex_lock                                                                                    ▒<br>   1.64%  [kernel]                [k] tick_nohz_idle_enter                                                                                  ▒<br>   1.41%  libpthread-2.17.so      [.] __lll_lock_wait                                                                                       ▒<br>   1.32%  [kernel]                [k] __audit_syscall_exit                                                                                  ▒<br>   1.21%  [kernel]                [k] __pv_queued_spin_lock_slowpath                                                                        ▒<br>   0.96%  [kernel]                [k] tick_nohz_idle_exit                                                                                   ▒<br>   0.91%  [kernel]                [k] __audit_syscall_entry                                                                                 ▒<br>   0.90%  libpthread-2.17.so      [.] __lll_unlock_wake                                                                                     ▒<br>   0.67%  [kernel]                [k] futex_wake                                                                                            ▒<br>   0.65%  [kernel]                [k] syscall_trace_enter                                                                                   ▒<br>   0.65%  kubelet                 [.] _start                                                                                                ▒<br>   0.65%  [kernel]                [k] do_idle                                                                                               ▒<br></code></pre></td></tr></table></figure>

<ul>
<li>Overhead ，是该符号的性能事件在所有采样中的比例，用百分比来表示</li>
<li>Shared ，是该函数或指令所在的动态共享对象（Dynamic Shared Object），如内核、进程名、动态链接库名、内核模块名等</li>
<li>Object ，是动态共享对象的类型。比如 [.] 表示用户空间的可执行程序、或者动态链接库，而 [k] 则表示内核空间</li>
<li>Symbol 是符号名，也就是函数名。当函数名未知时，用十六进制的地址来表示</li>
</ul>
<h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 运行测试服务</span><br>[root@test-tke-node-k21 ~]# docker run --name nginx -p 10000:80 -itd feisky/nginx<br>[root@test-tke-node-k21 ~]# docker run --name phpfpm -itd --network container:nginx feisky/php-fpm<br><br>[root@test-tke-node-k21 ~]# top<br>top - 11:07:07 up 127 days, 20:52,  2 users,  load average: 1.92, 1.42, 1.55<br>Tasks: 450 total,   6 running, 318 sleeping,   0 stopped,   0 zombie<br><span class="hljs-meta">%</span><span class="bash">Cpu(s): 41.0 us,  3.6 sy,  0.0 ni, 53.8 id,  0.0 wa,  0.0 hi,  1.6 si,  0.0 st</span><br>KiB Mem : 32412656 total, 15455832 free,  3158432 used, 13798392 buff/cache<br>KiB Swap:        0 total,        0 free,        0 used. 29064108 avail Mem<br><br>    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>1322604 root      20   0  212268  78780      0 S 189.9  0.2  54644:05 kube-proxy<br>3973285 bin       20   0  336696  16352   8664 R  98.7  0.1   0:08.04 php-fpm<br>3973319 bin       20   0  336696  13200   5520 R  98.7  0.0   0:07.96 php-fpm<br>3973320 bin       20   0  336696  13136   5456 R  98.7  0.0   0:07.95 php-fpm<br>3973321 bin       20   0  336696  13076   5396 R  98.7  0.0   0:07.88 php-fpm<br>3973322 bin       20   0  336696  13140   5460 R  98.7  0.0   0:07.88 php-fpm<br>   3581 root      20   0 2122004 160940  18672 S  11.4  0.5   7908:01 kubelet<br>2962155 root      20   0  729632  55472  12772 S  10.1  0.2 102:22.64 wukong-go<br>   3475 root      20   0 2384864 144036  18664 S   3.8  0.4  18601:39 dockerd<br>2035882 root      20   0  841168  17044  11040 S   2.5  0.1 151:47.57 YDEdr<br>3971722 root      20   0   12568   6140   1476 S   2.5  0.0   0:00.26 docker-proxy<br>      1 root      20   0  192996   7132   3692 S   1.3  0.0 620:19.81 systemd<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> perf 看出 add_function sqrt 消耗比较大</span><br>[root@test-tke-node-k21 ~]# perf top -g -p 3973285<br>Samples: 111K of event &#x27;cpu-clock&#x27;, Event count (approx.): 14077224392<br>  Overhead  Shared Object                      Symbol                                                                                   ◆<br>-    5.91%  php-fpm                            [.] add_function                                                                         ▒<br>   - 5.91% add_function                                                                                                                 ▒<br>      + 5.14% 0x98dd97                                                                                                                  ▒<br>-    5.74%  libm-2.24.so                       [.] sqrt                                                                                 ▒<br>     sqrt                                                                                                                               ▒<br>     0x8c4a7c                                                                                                                           ▒<br>     execute_ex                                                                                                                         ▒<br>     zend_execute                                                                                                                       ▒<br>     zend_execute_scripts                                                                                                               ▒<br>     php_execute_script                                                                                                                 ▒<br>     0x9cb642                                                                                                                           ▒<br>     __libc_start_main                                                                                                                  ▒<br>     0x6cb6258d4c544155                                                                                                                 ▒<br>+    4.87%  php-fpm                            [.] execute_ex                                                                           ▒<br>+    2.45%  php-fpm                            [.] 0x000000000094ede0                                                                   ▒<br>+    1.55%  php-fpm                            [.] 0x0000000000681b9d                                                                   ▒<br>+    0.95%  php-fpm                            [.] 0x00000000008cd720                                                                   ▒<br>+    0.80%  php-fpm                            [.] 0x0000000000681d21                                                                   ▒<br>+    0.79%  php-fpm                            [.] 0x0000000000681d1a                                                                   ▒<br>+    0.74%  php-fpm                            [.] 0x000000000098dc03<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 导出源码</span><br>[root@test-tke-node-k21 ~]# docker cp phpfpm:/app .<br>[root@test-tke-node-k21 ~]# grep sqrt -r app/<br>app/index.php:  $x += sqrt($x);<br><span class="hljs-meta">#</span><span class="bash"> add_function是php内置函数，这里看不到</span><br>[root@test-tke-node-k21 ~]# grep add_function -r app/<br>[root@test-tke-node-k21 ~]# cat app/index.php<br>&lt;?php<br>// test only.<br><span class="hljs-meta">$</span><span class="bash">x = 0.0001;</span><br>for ($i = 0; $i &lt;= 1000000; $i++) &#123;<br><span class="hljs-meta">  $</span><span class="bash">x += sqrt(<span class="hljs-variable">$x</span>);</span><br>&#125;<br><br>echo &quot;It works!&quot;<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 停止原来的应用</span><br>[root@test-tke-node-k21 ~] docker rm -f nginx phpfpm<br><span class="hljs-meta">#</span><span class="bash"> 运行优化后的应用</span><br>[root@test-tke-node-k21 ~] docker run --name nginx -p 10000:80 -itd feisky/nginx:cpu-fix<br>[root@test-tke-node-k21 ~] docker run --name phpfpm -itd --network container:nginx feisky/php-fpm:cpu-fix<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 应用里直接调用了其他二进制程序，这些程序通常运行时间比较短，通过 top 等工具也不容易发现</span><br><span class="hljs-meta">#</span><span class="bash"> 应用本身在不停地崩溃重启，而启动过程的资源初始化，很可能会占用相当多的 CPU</span><br><span class="hljs-meta">#</span><span class="bash"> 用下面的方式去排查</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 记录性能事件，等待大约15秒后按 Ctrl+C 退出</span><br>[root@test-tke-node-k21 ~] perf record -g<br><span class="hljs-meta">#</span><span class="bash"> 查看报告</span><br>[root@test-tke-node-k21 ~] perf report<br><br>[root@test-tke-node-k21 bin]# dstat 1 10<br>You did not select any stats, using -cdngy by default.<br>----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--<br>usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw<br>  6   2  88   0   0   3|  73k 2632k|   0     0 |   0     0 |  11k   35k<br>  0   0  99   0   0   0|4096B  608k| 108k  122k|   0     0 |7080    12k<br>  9   2  89   0   0   0|   0   472k| 111k  128k|   0     0 |8503    13k<br>  5   2  93   0   0   0|4096B  108k| 125k  231k|   0     0 |  10k   16k<br>  1   0  99   0   0   0|  16k  548k|  92k  102k|   0     0 |5700  9569<br>  2   1  97   0   0   0|8192B    0 |  87k  158k|   0     0 |  15k   25k<br>  7   3  90   0   0   0|4096B    0 | 121k   87k|   0     0 |  18k   30kq<br> 15   3  82   0   0   0|   0   656k|  76k  175k|   0     0 |  14k   23k<br></code></pre></td></tr></table></figure>


<h1 id="软中断"><a href="#软中断" class="headerlink" title="软中断"></a>软中断</h1><p>中断处理程序在响应中断时，还会临时关闭中断。这就会导致上一次中断处理完成之前，其他中断都不能响应，也就是说中断有可能会丢失。<br>Linux 将中断处理过程分成了两个阶段上半部和下半部，这样做的原因是<code>为了减少对正常进程运行调度的影响</code>，同时中断处理程序需要尽可能快地运行。</p>
<ul>
<li>上半部用来快速处理中断，它在中断禁止模式下运行，主要处理跟硬件紧密相关的或时间敏感的工作</li>
<li>下半部用来延迟处理上半部未完成的工作，通常以内核线程的方式运行</li>
</ul>
<p>网卡接收到数据包后，会通过硬件中断的方式，通知内核有新的数据到了。<br>这时，内核就应该调用中断处理程序来响应它。</p>
<ol>
<li>对上半部来说，其实就是要把网卡的数据读到内存中，然后更新一下硬件寄存器的状态（表示数据已经读好了）</li>
<li>最后再发送一个软中断信号，通知下半部做进一步的处理。</li>
<li>下半部被软中断信号唤醒后，需要从内存中找到网络数据，再按照网络协议栈，对数据进行逐层解析和处理，直到把它送给应用程序。</li>
</ol>
<p>总结来说：</p>
<ul>
<li>上半部直接处理硬件请求，也就是硬中断，特点是快速执行</li>
<li>下半部则是由内核触发，也就是软中断，特点是延迟执行</li>
</ul>
<p>实际上，上半部会打断 CPU 正在执行的任务，然后立即执行中断处理程序。而下半部以内核线程的方式执行，并且每个 CPU 都对应一个软中断内核线程，名字为 “ksoftirqd/CPU 编号”，比如说， 0 号 CPU 对应的软中断内核线程的名字就是 ksoftirqd/0。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 软中断内核线程就叫做 ksoftirqd/CPU 编号， 查看方式</span><br>[root@test-monitor-farseer-1 ~]# ps aux | grep softirq<br>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>root         6  0.0  0.0      0     0 ?        S    Oct28  19:01 [ksoftirqd/0]<br>root        14  0.0  0.0      0     0 ?        S    Oct28  18:35 [ksoftirqd/1]<br>root        19  0.0  0.0      0     0 ?        S    Oct28   7:09 [ksoftirqd/2]<br>root        24  0.0  0.0      0     0 ?        S    Oct28   7:10 [ksoftirqd/3]<br>root     30245  0.0  0.0 112816   968 pts/0    S+   14:39   0:00 grep --color=auto softirq<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 各种类型软中断在不同 CPU 上的累积运行次数</span><br><span class="hljs-meta">#</span><span class="bash"> TIMER（定时中断）、NET_RX（网络接收）、SCHED（内核调度）、RCU（RCU 锁）</span><br>[root@test-monitor-farseer-1 ~]# cat /proc/softirqs<br>                    CPU0       CPU1       CPU2       CPU3<br>          HI:          0          0          1          0<br>       TIMER:  292014081  279537013  269216764  281696252<br>      NET_TX:       3831       3913       4199       4184<br>      NET_RX:  618581709  594412079  267227921  266352263<br>       BLOCK:   14715145          0          0          0<br>BLOCK_IOPOLL:          0          0          0          0<br>     TASKLET:       2443       2477       2541       2794<br>       SCHED:   99688071   94729309   93448448  103069610<br>     HRTIMER:          0          0          0          0<br>         RCU:   78026892   73588176   68355387   69822162<br></code></pre></td></tr></table></figure>

<h1 id="CPU缓存"><a href="#CPU缓存" class="headerlink" title="CPU缓存"></a>CPU缓存</h1><p>CPU缓存是为了解决CPU运算速度与内存读写速度不匹配的矛盾，因为CPU的运算速度要比内存读写速度快很多，这样会使CPU需要等待数据的到来或把数据写入到内存中。<br>高速缓存控制器是针对数据块，而不是字节进行操作的。高速缓存其实就是一组称之为缓存行(Cache Line)的固定大小的数据块组成的，典型的一行是64字节。</p>
<h2 id="CPU缓存的意义"><a href="#CPU缓存的意义" class="headerlink" title="CPU缓存的意义"></a>CPU缓存的意义</h2><p>CPU往往需要重复处理相同的数据、重复执行相同的指令，如果这部分数据、指令能在CPU缓存中找到，CPU就不需要从内存或硬盘中再读取数据、指令，从而减少了整机的响应时间。<br>CPU缓存的意义满足以下两种局部性原理：</p>
<ul>
<li>时间局部性（Temporal Locality）：如果一个信息项正在被访问，那么在近期它很可能还会被再次访问。</li>
<li>空间局部性（Spatial Locality）：如果一个存储器的位置被引用，那么将来他附近的位置也会被引用。</li>
</ul>
<p>就像数据库缓存一样，获取数据时首先会在最快的缓存中找数据，如果缓存没有命中(Cache miss) 则往下一级找, 直到三级缓存都找不到时，那只有向内存要数据了。一次次地未命中，代表取数据消耗的时间越长。</p>
<p><img src="/images/cpu/%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E5%A4%9A%E6%A0%B8%E6%9C%BA%E5%99%A8%E7%9A%84%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png" alt="高速缓存多核机器的存储结构"></p>
<p><img src="/images/cpu/IntelCorei5.png" alt="IntelCorei5"></p>
<h2 id="带有高速缓存CPU执行计算的流程"><a href="#带有高速缓存CPU执行计算的流程" class="headerlink" title="带有高速缓存CPU执行计算的流程"></a>带有高速缓存CPU执行计算的流程</h2><ul>
<li>程序以及数据被加载到主内存</li>
<li>指令和数据被加载到CPU的高速缓存</li>
<li>CPU执行指令，把结果写到高速缓存</li>
<li>高速缓存中的数据写回主内存</li>
</ul>
<p><img src="/images/cpu/CPU%E6%89%A7%E8%A1%8C%E8%AE%A1%E7%AE%97%E7%9A%84%E6%B5%81%E7%A8%8B.png" alt="CPU执行计算的流程"></p>
<h2 id="CPU缓存一致性协议-MESI"><a href="#CPU缓存一致性协议-MESI" class="headerlink" title="CPU缓存一致性协议-MESI"></a>CPU缓存一致性协议-MESI</h2><p>MESI为了保证多个CPU缓存中共享数据的一致性，为缓存行(Cache Line)定义了四种状态，而CPU对缓存行的四种操作可能会产生不一致的状态，因此缓存控制器监听到本地操作和远程操作的时候，需要对地址一致的缓存行的状态进行一致性修改，从而保证数据在多个缓存之间保持一致性。</p>
<h3 id="MESI状态"><a href="#MESI状态" class="headerlink" title="MESI状态"></a>MESI状态</h3><table>
<thead>
<tr>
<th>状态</th>
<th>描述</th>
<th>监听任务</th>
<th>状态转换</th>
</tr>
</thead>
<tbody><tr>
<td>M 修改 (Modified)</td>
<td>该Cache line有效，数据被修改了，和内存中的数据不一致，数据只存在于本Cache中</td>
<td>缓存行必须时刻监听所有试图读该缓存行相对就主存的操作，这种操作必须在缓存将该缓存行写回主存并将状态变成S（共享）状态之前被延迟执行</td>
<td>当被写回主存之后，该缓存行的状态会变成独享（exclusive)状态</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>E 独享、互斥 (Exclusive)</td>
<td>该Cache line有效，数据和内存中的数据一致，数据只存在于本Cache中</td>
<td>缓存行必须监听其它缓存读主存中该缓存行的操作，一旦有这种操作，该缓存行需要变成S（共享）状态。</td>
<td>当CPU修改该缓存行中内容时，该状态可以变成Modified状态</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>S 共享 (Shared)</td>
<td>该Cache line有效，数据和内存中的数据一致，数据存在于很多Cache中</td>
<td>缓存行必须监听其它缓存使该缓存行无效或者独享该缓存行的请求，并将该缓存行变成无效（Invalid）</td>
<td>当有一个CPU修改该缓存行时，其它CPU中该缓存行可以被作废（变成无效状态 Invalid）</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>I 无效 (Invalid)</td>
<td>该Cache line无效。</td>
<td>无</td>
<td>无</td>
</tr>
</tbody></table>
<p><img src="/images/cpu/cpu%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9E%B6%E6%9E%84.png" alt="cpu多级缓存架构"></p>
<h3 id="多核缓存协同操作"><a href="#多核缓存协同操作" class="headerlink" title="多核缓存协同操作"></a>多核缓存协同操作</h3><p>内存变量</p>
<p><img src="/images/cpu/1.png" alt="内存变量"></p>
<p>单核读取</p>
<p><img src="/images/cpu/2.png" alt="单核读取"></p>
<p>双核读取</p>
<p><img src="/images/cpu/3.png" alt="双核读取"></p>
<p>修改数据</p>
<p><img src="/images/cpu/4.png" alt="修改数据"></p>
<p>同步数据</p>
<p><img src="/images/cpu/5.png" alt="同步数据"></p>
<h3 id="CPU-存储模型简介"><a href="#CPU-存储模型简介" class="headerlink" title="CPU 存储模型简介"></a>CPU 存储模型简介</h3><p>MESI协议为了保证多个 CPU cache 中共享数据的一致性，定义了 Cache line 的四种状态，而 CPU 对 cache 的4种操作可能会产生不一致状态，因此 cache 控制器监听到本地操作和远程操作的时候，需要对地址一致的 Cache line 状态做出一定的修改，从而保证数据在多个cache之间流转的一致性。</p>
<p>但是，缓存的一致性消息传递是要时间的，这就使得状态切换会有更多的延迟。某些状态的切换需要特殊的处理，可能会阻塞处理器。这些都将会导致各种各样的稳定性和性能问题。比如你需要修改本地缓存中的一条信息，那么你必须将I（无效）状态通知到其他拥有该缓存数据的CPU缓存中，并且等待确认。等待确认的过程会阻塞处理器，这会降低处理器的性能。因为这个等待远远比一个指令的执行时间长的多。所以，为了为了避免这种阻塞导致时间的浪费，引入了存储缓存(Store Buffer)和无效队列(Invalidate Queue)。</p>
<!-- 
### 存储缓存

在没有存储缓存时，CPU 要写入一个量，有以下情况：

- 量不在该 CPU 缓存中，则需要发送 Read Invalidate 信号，再等待此信号返回，之后再写入量到缓存中。
- 量在该 CPU 缓存中，如果该量的状态是 Exclusive 则直接更改。而如果是 Shared 则需要发送 Invalidate 消息让其它 CPU 感知到这一更改后再更改。

这些情况中，很有可能会触发该 CPU 与其它 CPU 进行通讯，接着需要等待它们回复。这会浪费大量的时钟周期！为了提高效率，可以使用异步的方式去处理：先将值写入到一个 Buffer 中，再发送通讯的信号，等到信号被响应，再应用到 cache 中。并且此 Buffer 能够接受该 CPU 读值。这个 Buffer 就是 Store Buffer。而不须要等待对某个量的赋值指令的完成才继续执行下一条指令，直接去 Store Buffer 中读该量的值，这种优化叫Store Forwarding。

### 无效队列

同理，解决了主动发送信号端的效率问题，那么，接受端 CPU 接受到 Invalidate 信号后如果立即采取相应行动(去其它 CPU 同步值)，再返回响应信号，则时钟周期也太长了，此处也可优化。接受端 CPU 接受到信号后不是立即采取行动，而是将 Invalidate 信号插入到一个队列 Queue 中，立即作出响应。等到合适的时机，再去处理这个 Queue 中的 Invalidate 信号，并作相应处理。这个 Queue 就是Invalidate Queue。 -->


<p><img src="/images/cpu/%E6%A0%B9%E6%8D%AE%E6%8C%87%E6%A0%87%E6%89%BE%E5%B7%A5%E5%85%B7.png" alt="根据指标找工具"><br><img src="/images/cpu/%E9%80%9A%E8%BF%87%E5%B7%A5%E5%85%B7%E6%9F%A5%E6%8C%87%E6%A0%87.png" alt="通过工具查指标"><br><img src="/images/cpu/CPU%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%88%86%E6%9E%90.png" alt="CPU性能优化分析"><br><img src="/images/cpu/linux%E6%80%A7%E8%83%BD%E5%9B%BE%E8%B0%B1.png" alt="Linux性能图谱"></p>
<!-- false sharing --></div></article><div class="post-view__sidebar"><div class="sidebar"><div class="tocbot"><h2>Toc</h2><div class="toc__content"></div></div><h2>Links</h2><div class="sidebar__link"><ul><li><a href="mailto:imscc@qq.com">Mail</a></li></ul></div><h2>Archives</h2><div class="sidebar__archives"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li></ul></div><h2>Categories</h2><div class="sidebar__categories"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li></ul></div><h2>Tags</h2><div class="sidebar__tags"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/db/" rel="tag">db</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul></div></div></div></div><div class="horizontal-line" style="height: 1px"></div><div class="main__bottom"><div class="pre-next"><a class="pre-button" href="/2020/12/09/io%E5%88%86%E6%9E%90/">io知识</a><a class="next-button" href="/2020/07/20/%E8%BF%9B%E7%A8%8B%E5%B0%8F%E7%9F%A5%E8%AF%86/">进程小知识</a></div></div></div></div><div class="footer"><span>©️2019-2021 Designed By&nbsp;<strong><a target="_blank" rel="noopener" href="https://github.com/random-yang">RandomYang</a></strong> Powered By&nbsp;</span><strong><a target="_blank" rel="noopener" href="https://hexo.io">hexo</a></strong></div><div class="darkmode-mask" id="darkmode-mask"></div><div class="sidebar__button"></div></body></html>